<?xml version="1.0" encoding="utf-8"?>

<nlog autoReload="true"
      internalLogLevel="Warn"
      internalLogFile=".logs/internal-nlog.txt">

    <!-- ========================================================= -->
    <!-- Variablen -->
    <!-- ========================================================= -->
    <variable name="logDir" value="${basedir}/logs" />
    <variable name="logDate" value="${processid}" />

    <!-- ========================================================= -->
    <!-- Targets -->
    <!-- ========================================================= -->
    <targets>

            <!-- ================= API ================= -->
            <target xsi:type="File"
                    name="apiFile"
                    fileName="${logDir}/BauFahrplanMonitor_api_${logDate}.log"
                    createDirs="true"
                    layout="${longdate}|${level}|${logger}|${message}${exception:format=ToString}" />

            <!-- ================= Importer ================= -->
            <target xsi:type="File"
                    name="importFile"
                    fileName="${logDir}/BauFahrplanMonitor_import_${logDate}.log"
                    createDirs="true"
                    layout="${longdate}|${level}|${scopeproperty:ImportFile}|${scopeproperty:Zugnr}|${scopeproperty:Verkehrstag}|${callsite}|${message}${exception:format=ToString}" />

            <!-- ================= EF Core SQL ================= -->
            <target xsi:type="File"
                    name="efSqlFile"
                    fileName="${logDir}/BauFahrplanMonitor_efsql_${logDate}.log"
                    createDirs="true"
                    layout="${longdate}|${level}|${logger}|${message}" />

            <!-- ================= Console (NUR Importer) ================= -->
            <target xsi:type="Console"
                    name="console"
                    llayout="${longdate}|${level}|${scopeproperty:ImportFile:whenEmpty=-}|${message}${exception:format=Message}" />

    </targets>

    <!-- ========================================================= -->
    <!-- Rules -->
    <!-- ========================================================= -->
    <rules>

            <!-- ================= EF Core (niemals Console!) ================= -->
            <logger name="Microsoft.EntityFrameworkCore.Database.Command*"
                    minlevel="Information"
                    writeTo="efSqlFile"
                    final="true" />

            <!-- ================= API (niemals Console!) ================= -->
            <logger name="BauFahrplanMonitor.Api.*"
                    minlevel="Info"
                    writeTo="apiFile"
                    final="true" />

            <!-- ================= Importer / Core ================= -->
            <logger name="BauFahrplanMonitor.Core.*"
                    minlevel="Info"
                    writeTo="importFile,console"
                    final="true" />

            <logger name="BauFahrplanMonitor.Importer.*"
                    minlevel="Info"
                    writeTo="importFile,console"
                    final="true" />

            <!-- ================= Fallback (kein Console!) ================= -->
            <logger name="*"
                    minlevel="Warn"
                    writeTo="apiFile,importFile" />

    </rules>

</nlog>