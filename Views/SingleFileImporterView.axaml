<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:BauFahrplanMonitor.ViewModels"
    xmlns:controls="clr-namespace:BauFahrplanMonitor.Views.Controls"
    x:Class="BauFahrplanMonitor.Views.SingleFileImporterView">

    <!-- ================================================= -->
    <!-- ROOT -->
    <!-- ================================================= -->
    <Grid RowDefinitions="Auto,Auto,Auto,Auto,*,Auto"
          Margin="16"
          RowSpacing="12">

        <!-- ================================= -->
        <!-- HEADER -->
        <!-- ================================= -->
        <Grid Grid.Row="0"
              ColumnDefinitions="*,Auto"
              VerticalAlignment="Center">

            <!-- LINKS: Titel -->
            <TextBlock
                Text="{Binding Title}"
                FontSize="16"
                FontWeight="SemiBold"
                VerticalAlignment="Center" />

            <!-- RECHTS: Status Pill -->
            <Border
                Grid.Column="1"
                Background="{Binding StatusBrush}"
                CornerRadius="12"
                Padding="10,2"
                VerticalAlignment="Center">

                <TextBlock
                    Text="{Binding StatusText}"
                    FontSize="12"
                    Foreground="White" />
            </Border>

        </Grid>

        <!-- ================================= -->
        <!-- DATEI -->
        <!-- ================================= -->
        <StackPanel Grid.Row="1"
                    Spacing="6">

            <!-- Zeile 1: Label -->
            <TextBlock
                Text="Datei:"
                FontWeight="SemiBold" />

            <!-- Zeile 2: TextBox + Button -->
            <Grid ColumnDefinitions="*,Auto"
                  ColumnSpacing="12">

                <!-- Textbox -->
                <TextBox
                    Text="{Binding ImportFile}"
                    IsReadOnly="True"
                    Watermark="Keine Datei ausgewählt"
                    VerticalContentAlignment="Center" />

                <!-- Öffnen-Button mit Icon + Text -->
                <Button
                    Grid.Column="1"
                    Command="{Binding SelectFileCommand}">

                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock
                            FontFamily="{StaticResource FontAwesomeSolid}"
                            Text="&#xF07C;" /> <!-- folder-open -->
                        <TextBlock Text="Öffnen" />
                    </StackPanel>

                </Button>
            </Grid>

        </StackPanel>

        <!-- ================================= -->
        <!-- START / STOP -->
        <!-- ================================= -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="8">

            <!-- Start -->
            <Button
                Command="{Binding StartCommand}"
                IsEnabled="{Binding CanStart}">

                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock
                        FontFamily="{StaticResource FontAwesomeSolid}"
                        Text="&#xF04B;" /> <!-- play -->
                    <TextBlock Text="Start" />
                </StackPanel>

            </Button>

            <!-- Stopp -->
            <Button
                Command="{Binding StopCommand}"
                IsEnabled="{Binding CanStop}">

                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock
                        FontFamily="{StaticResource FontAwesomeSolid}"
                        Text="&#xF04D;" /> <!-- stop -->
                    <TextBlock Text="Stopp" />
                </StackPanel>

            </Button>

        </StackPanel>

        <!-- ================================================= -->
        <!-- OVERALL PROGRESS -->
        <!-- ================================================= -->
        <StackPanel Grid.Row="3"
                    Spacing="6">

            <Border Height="1"
                    Background="#444"
                    Opacity="0.6" />

            <Grid ColumnDefinitions="*,Auto">
                <TextBlock
                    Text="Gesamtfortschritt"
                    FontWeight="SemiBold" />

                <TextBlock
                    Grid.Column="1"
                    Text="{Binding ProgressPercentText}"
                    Foreground="#777" />
            </Grid>

            <ProgressBar
                Value="{Binding OverallProgress}"
                Maximum="1"
                Height="6" />

            <TextBlock
                Text="{Binding OverallProgressText}"
                Foreground="#777"
                FontSize="12" />

            <Border Height="1"
                    Background="#444"
                    Opacity="0.6" />
        </StackPanel>

        <!-- ================================================= -->
        <!-- THREADS -->
        <!-- ================================================= -->
        <ScrollViewer Grid.Row="4"
                      VerticalScrollBarVisibility="Auto">

            <ItemsControl ItemsSource="{Binding Threads}">
                <ItemsControl.ItemTemplate>

                    <DataTemplate>

                        <!-- ========================= -->
                        <!-- THREAD CARD -->
                        <!-- ========================= -->
                        <Border
                            CornerRadius="8"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            Background="#FAFAFA"
                            Padding="16"
                            Margin="0,12,0,0">

                            <Grid ColumnDefinitions="*,*,*"
                                  RowDefinitions="Auto,Auto">

                                <!-- HEADER -->
                                <Grid Grid.Row="0"
                                      Grid.ColumnSpan="3"
                                      ColumnDefinitions="*,Auto,*"
                                      VerticalAlignment="Center">

                                    <!-- Links: Thread + Pill -->
                                    <Grid Grid.Column="0"
                                          ColumnDefinitions="Auto,Auto"
                                          ColumnSpacing="12">

                                        <TextBlock
                                            Text="{Binding WorkerIndex, StringFormat=Thread {0}}"
                                            FontWeight="SemiBold"
                                            FontSize="14" />

                                        <Border
                                            Background="{Binding StatusBrush}"
                                            CornerRadius="10"
                                            Padding="10,2">

                                            <TextBlock
                                                Text="{Binding StatusText}"
                                                FontSize="12"
                                                Foreground="White" />
                                        </Border>
                                    </Grid>

                                    <!-- Rechts: Statistik -->
                                    <TextBlock
                                        Grid.Column="2"
                                        Text="Statistik"
                                        FontWeight="SemiBold" />
                                </Grid>

                                <!-- BODY LINKS -->
                                <StackPanel Grid.Row="1"
                                            Grid.Column="0"
                                            Margin="0,8,0,0"
                                            Spacing="6">

                                    <TextBlock
                                        Text="{Binding StatusText}"
                                        Foreground="#777" />

                                    <TextBlock
                                        Text="{Binding ProgressText}"
                                        Foreground="Black"
                                        FontSize="12" />
                                </StackPanel>

                                <!-- BODY RECHTS -->
                                <StackPanel Grid.Row="1"
                                            Grid.Column="2"
                                            Margin="0,8,0,0"
                                            Spacing="6">

                                    <ItemsControl ItemsSource="{Binding Statistics}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <controls:StatRow
                                                    Label="{Binding Key}"
                                                    Value="{Binding Value}" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                            </Grid>
                        </Border>

                    </DataTemplate>

                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>